<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>Model U-Boat Module Control by emmesolutions</title>
  </head>

  <body>
    <div id="container">
      <div class="inner">

        <header>
          <h1>Model U-Boat Module Control</h1>
          <h2>U-Boat Module Control (Arduino Hardware Control + RaspberryPi Web Interface)</h2>
        </header>

        <section id="downloads" class="clearfix">
          <a href="https://github.com/emmesolutions/Model_UBoatMC/zipball/master" id="download-zip" class="button"><span>Download .zip</span></a>
          <a href="https://github.com/emmesolutions/Model_UBoatMC/tarball/master" id="download-tar-gz" class="button"><span>Download .tar.gz</span></a>
          <a href="https://github.com/emmesolutions/Model_UBoatMC" id="view-on-github" class="button"><span>View on GitHub</span></a>
        </section>

        <hr>

        <section id="main_content">
          <h1>
<a id="u-boat-module-control" class="anchor" href="#u-boat-module-control" aria-hidden="true"><span class="octicon octicon-link"></span></a>U-Boat Module Control</h1>

<p><strong>Arduino Hardware Control + RaspberryPi Web Interface</strong></p>

<p><strong>Project divided into two parts:</strong></p>

<ul>
<li>
<a href="WM_InoSketch/">WM_InoSketch</a> Arduino Sketch for U-Boat Hardware Control </li>
<li>
<a href="WM_RPinoWI/">WM_RPinoWI</a>  Operator Command Web Interface for RaspberryPi Web Server</li>
<li>
<a href="WM_Shield/">WM_Shield</a> Arduino Shield for U-Boat Hardware Control</li>
</ul>

<p><strong>-</strong></p>

<pre><code> Copyright (C) 2014 Martinelli Michele

 This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.
</code></pre>

<h2>
<a id="description" class="anchor" href="#description" aria-hidden="true"><span class="octicon octicon-link"></span></a>Description:</h2>

<p><strong>Hardware:</strong></p>

<ul>
<li>ARDUINO Mega 2560</li>
<li>RaspberryPi</li>
<li>Ethernet Shield</li>
<li>Monster Moto Shiled (Main Engine + Ballast Tank)</li>
<li>Current Sensor ACS714</li>
<li>GPS Module EM406A</li>
<li>Compass Module CMPS10</li>
<li>Servo Controller (Rudders Direction/Depth)</li>
<li>Pressure Sensor SSCDRNN015PAAA5 Honeywell</li>
<li>Temperature Sensor DS18B20 Maxim</li>
<li>Temperature Sensor LM35 (Motors)</li>
<li><p>Sonar Sensor MB7078 XL-MaxSonar-WRCA </p></li>
<li><p>Arduino Shield (UMC_131012_030)</p></li>
</ul>

<p><strong>Library:</strong></p>

<ul>
<li>SPI</li>
<li>Ethernet</li>
<li>Servo</li>
<li>Wire</li>
<li>TinyGPS</li>
<li>OneWire</li>
<li>DHT22</li>
</ul>

<p><strong>Arduino:</strong></p>

<ul>
<li>Reading DS18B20 Sensors</li>
<li>Reading DHT22 Sensors</li>
<li>Compass Module CMPS10</li>
<li>GPS Module EM406A</li>
<li>Data Calculations</li>
<li>Web Communication</li>
<li>Main Engine Command</li>
<li>Rudders Command</li>
<li>Ballast Tank Command</li>
<li>Auxiliary Command</li>
<li>Serial Print Debug</li>
</ul>

<p><strong>RaspberryPi:</strong></p>

<ul>
<li>LAMP Web Server</li>
<li>OP.Cmd Web Interface</li>
<li>MySQL Datalogger</li>
</ul>

<h2>
<a id="wiring" class="anchor" href="#wiring" aria-hidden="true"><span class="octicon octicon-link"></span></a>Wiring:</h2>

<p><strong>PWM Out:</strong></p>

<ul>
<li>Pin 2  - Main Engine Direction Ahead</li>
<li>Pin 3  - Main Engine Direction Astern</li>
<li>Pin 4  - Main Engine Speed</li>
<li>Pin 5  - Rudder (Direction)</li>
<li>Pin 6  - Rudder (Depth)</li>
<li>Pin 7  - Ballast Tank Direction Diving</li>
<li>Pin 8  - Ballast Tank Direction Emersion</li>
<li>Pin 9  - Ballast Tank Speed</li>
<li>Pin 10 - (Ethernet Shield)</li>
<li>Pin 11 - (Ethernet Shield)</li>
<li>Pin 12 - (Ethernet Shield)</li>
<li>Pin 13 - Link LED Web Client Connect</li>
</ul>

<p><strong>Communication:</strong></p>

<ul>
<li>Pin 18 - EM406A GPS Module (Serial1 - TX)</li>
<li>Pin 19 - EM406A CPS Module (Serial1 - RX)</li>
<li>Pin 20 - CMPS10 Compass Module (SDA)</li>
<li>Pin 21 - CMPS10 Compass Module (SCL)</li>
</ul>

<p><strong>Digital Out</strong></p>

<ul>
<li>Pin 40 - Flashing</li>
<li>Pin 43 - Horn Signaling</li>
<li>Pin 45 - Auxiliary Light</li>
<li>Pin 49 - Buzzer Signaling</li>
</ul>

<p><strong>Analog In:</strong></p>

<ul>
<li>Pin 5  - Main Engine Motor Temperature (Sensor LM35)</li>
<li>Pin 6  - Ballast Tank Motor Temperature (Sensor LM35)</li>
<li>Pin 7  - Main Engine Motor Current Sense</li>
<li>Pin 8  - Ballast Tank Motor Current Sense</li>
<li>Pin 9  - Engine Battery Current</li>
<li>Pin 10 - RaspberryPi Supply (3,3V)</li>
<li>Pin 11 - Pressure (Sensor SSCDRNN015P)</li>
<li>Pin 12 - Hardware Battery Voltage</li>
<li>Pin 13 - Engine Battery Voltage</li>
<li>Pin 14 - Front Sonar Sensor(Sensor MB7078 Vcc/1024 for Cm)</li>
<li>Pin 15 - Bottom Sonar Sensor(Sensor MB7078 Vcc/1024 for Cm)</li>
</ul>

<p><strong>Digital In:</strong></p>

<ul>
<li>Pin 22 - Temperature Sensors (DS18B20 OneWire Protocol)</li>
<li>Pin 23 - Auxiliary IO</li>
<li>Pin 24 - Ballast Tank Full</li>
<li>Pin 25 - Auxiliary IO</li>
<li>Pin 26 - Ballast Tank Empty</li>
<li>Pin 27 - Auxiliary IO</li>
<li>Pin 29 - Flooding Sensor</li>
<li>Pin 31 - Collision Sensor Bow</li>
<li>Pin 33 - Collision Sensor Stern</li>
<li>Pin 35 - Collision Sensor Port</li>
<li>Pin 37 - Collision Sensor Starboard</li>
<li>Pin 39 - Temperature and Humidity Sensor DHT22</li>
<li>Pin 41 - Auxiliary IO</li>
<li>Pin 42 - RaspberryPi GPIO</li>
</ul>

<h2>
<a id="system-structure" class="anchor" href="#system-structure" aria-hidden="true"><span class="octicon octicon-link"></span></a>System Structure:</h2>

<p><strong>ARDUINO</strong>
Main U-Boat controller</p>

<ul>
<li>Function...</li>
<li>Web Comunication Function
 Send Data via GET method:<br>
http://..../index.php?TimeSc=...&amp;DateD=...&amp;DateM=...</li>
</ul>

<p><strong>Data List:</strong></p>

<pre><code>    TimeSc Time On

    DateD  Day
    DateM  Month
    DateY  Year
    TimeH  Hour
    TimeM  Minute

    GPSLat GPS Latitude
    GPSLng GPS Longitude
    CmpsH  Compass Heading
CmpsP  Compass Pitch
CmpsR  Compass Roll
    Speed  Speed
    Depth  Depth

    TmpExt Temperature External
    TmpInt Temperature Internal
    HmdInt Humidity Internal
    TmpH2O Temperature Water
    MEnTmp Main Engine Motor Temperature
    BlTTmp Ballast Tank Motor Temperature

    HdwBtV HdwBtV Hardware Battery Voltage
    EngBtV Engine Battery Voltage
    EngBtI Engine Battery Current
    RPiBtV RPi Battery Voltage
    BtAtmy Battery Autonomy
    MEnSnI Main Engine Motor Current
    BlTSnI Ballast Tank Motor Current

    SonarF Sonar Front
    SonarB Sonar Back
    CllSnr Collision Sensors

    OprCmd Operator Command
    PrmCmd Parameter Command
    MsgAlm Message Allarm
    CmdSts Command Status
    InpSts Digital Input Status
    OutSts Digital Output Status
</code></pre>

<ul>
<li>  Read Data via GET method</li>
<li>  '$' Read OpCmd (Operator Command)</li>
<li>  '@' Read PrCmd (Parameter Command)</li>
<li>  OpCmd_Rd0 Op.Command Care On</li>
<li>  OpCmd_Wt0 Waiting Care On</li>
<li>  PrCmd_Rd0 Calculation</li>
<li>  OpCmd_Rd0 + OpCmd_Wt0 = OpCmd_Rd1 Op.Command Execution</li>
</ul>

<p><strong>RASPBERRY PI</strong>
Web Server for Operator Command Web Interface</p>

<ul>
<li> Read Data via GET method</li>
<li> Send Operator Command via GET method:
http://..../index.php?$[OpCmd]@[OpCmd Parameter]</li>
</ul>

<p><strong>OpCmd List:</strong></p>

<pre><code>       00  "Engine Stop"
       01  "Fixed/Reset Rudder Direction"
       02  "Quadrant Turn Port Direction"
       03  "Quadrant Turn Starboard Direction"
       04  "90° Turn Port Direction"
       05  "90° Turn Starboard Direction"
       06  "Reversing Port Direction"
       07  "Reversing Starboard Direction"
       08  "Engine Astern"
       09  "Engine Ahead"
       10  "Dynamic Emersion"
       11  "Dynamic Diving"
       12  "Static Emersion"
       13  "Static Diving"
       14  "Surface"
       15  "Fixed/Reset Rudder Depth"
       21   C1
       22   C2
       23   C3
       24   C4
</code></pre>

<h2></h2>
        </section>

        <footer>
          Model U-Boat Module Control is maintained by <a href="https://github.com/emmesolutions">emmesolutions</a><br>
          This page was generated by <a href="https://pages.github.com">GitHub Pages</a>. Tactile theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.
        </footer>

        
      </div>
    </div>
  </body>
</html>